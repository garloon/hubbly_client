<?xml version="1.0" encoding="utf-8" ?>
<Shell
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:views="clr-namespace:Hubbly.Mobile.Views"
    xmlns:viewmodels="clr-namespace:Hubbly.Mobile.ViewModels"
    xmlns:components="clr-namespace:Hubbly.Mobile.Components"
    x:Class="Hubbly.Mobile.AppShell"
    x:Name="Shell"
    FlyoutBehavior="Flyout"
    BackgroundColor="{DynamicResource PageBackgroundColor}"
    Shell.FlyoutHeaderBehavior="CollapseOnScroll"
    Shell.NavBarIsVisible="False">

    <!-- Shell Structure -->
    <Shell.FlyoutHeader>
        <Grid HeightRequest="180"
              BackgroundColor="{DynamicResource PrimaryColor}"
              Padding="{StaticResource SpacingMd}">
            <VerticalStackLayout VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 Spacing="{StaticResource SpacingSm}">

                <!-- User Avatar (using new AvatarView component) -->
                <components:AvatarView Nickname="{Binding UserInitials}"
                                       AvatarColor="White"
                                       Size="Large"
                                       ShowOnlineStatus="True"
                                       IsOnline="True"
                                       HorizontalOptions="Center" />

                <!-- User Nickname -->
                <Label Text="{Binding UserNickname}"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalTextAlignment="Center" />

                <!-- Online Status -->
                <Label Text="Online"
                       FontSize="12"
                       TextColor="#CCFFFFFF"
                       HorizontalTextAlignment="Center" />

            </VerticalStackLayout>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- Shell Content Area -->
    <Shell.FlyoutContentTemplate>
        <DataTemplate>
            <Grid RowDefinitions="Auto,*"
                  BackgroundColor="{DynamicResource PageBackgroundColor}">

                <!-- Flyout Header (User info) -->
                <Frame Grid.Row="0"
                       BackgroundColor="{DynamicResource CardBackgroundColor}"
                       BorderColor="{DynamicResource BorderColor}"
                       Margin="{StaticResource SpacingSm}"
                       Padding="{StaticResource SpacingMd}"
                       CornerRadius="12"
                       HasShadow="False">
                    <VerticalStackLayout Spacing="{StaticResource SpacingXs}">

                        <!-- User Avatar & Name -->
                        <HorizontalStackLayout Spacing="{StaticResource SpacingMd}"
                                               VerticalOptions="Center">
                            <components:AvatarView Nickname="{Binding UserInitials}"
                                                   AvatarColor="{DynamicResource PrimaryColor}"
                                                   Size="Medium"
                                                   ShowOnlineStatus="False"
                                                   HorizontalOptions="Start" />

                            <VerticalStackLayout Spacing="{StaticResource SpacingXs}"
                                                 VerticalOptions="Center">
                                <Label Text="{Binding UserNickname}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource TextColor}" />
                                <Label Text="Online"
                                       FontSize="12"
                                       TextColor="{DynamicResource SecondaryTextColor}" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                    </VerticalStackLayout>
                </Frame>

                <!-- Flyout Menu Items -->
                <ScrollView Grid.Row="1"
                            VerticalScrollBarVisibility="Never"
                            Margin="{StaticResource SpacingSm}">
                    <VerticalStackLayout Spacing="{StaticResource SpacingSm}">

                        <!-- Chat Room Menu Item -->
                        <Frame BackgroundColor="{DynamicResource CardBackgroundColor}"
                               BorderColor="{DynamicResource BorderColor}"
                               Padding="{StaticResource SpacingMd}"
                               CornerRadius="8"
                               HasShadow="False">
                            <Grid ColumnDefinitions="Auto,*"
                                  ColumnSpacing="{StaticResource SpacingMd}">
                                <Label Grid.Column="0"
                                       Text="ðŸ’¬"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       TextColor="{DynamicResource TextColor}"
                                       Opacity="0.7" />
                                <Label Grid.Column="1"
                                       Text="{Binding ChatRoomTitle}"
                                       FontSize="16"
                                       TextColor="{DynamicResource TextColor}"
                                       VerticalOptions="Center" />
                            </Grid>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenChatCommand}" />
                            </Frame.GestureRecognizers>
                        </Frame>

                        <!-- Room Selection Menu Item -->
                        <Frame BackgroundColor="{DynamicResource CardBackgroundColor}"
                               BorderColor="{DynamicResource BorderColor}"
                               Padding="{StaticResource SpacingMd}"
                               CornerRadius="8"
                               HasShadow="False">
                            <Grid ColumnDefinitions="Auto,*"
                                  ColumnSpacing="{StaticResource SpacingMd}">
                                <Label Grid.Column="0"
                                       Text="ðŸšª"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       TextColor="{DynamicResource TextColor}"
                                       Opacity="0.7" />
                                <Label Grid.Column="1"
                                       Text="Select Room"
                                       FontSize="16"
                                       TextColor="{DynamicResource TextColor}"
                                       VerticalOptions="Center" />
                            </Grid>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenRoomSelectionCommand}" />
                            </Frame.GestureRecognizers>
                        </Frame>

                        <!-- Settings Menu Item -->
                        <Frame BackgroundColor="{DynamicResource CardBackgroundColor}"
                               BorderColor="{DynamicResource BorderColor}"
                               Padding="{StaticResource SpacingMd}"
                               CornerRadius="8"
                               HasShadow="False">
                            <Grid ColumnDefinitions="Auto,*"
                                  ColumnSpacing="{StaticResource SpacingMd}">
                                <Label Grid.Column="0"
                                       Text="âš™ï¸"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       TextColor="{DynamicResource TextColor}"
                                       Opacity="0.7" />
                                <Label Grid.Column="1"
                                       Text="{Binding SettingsTitle}"
                                       FontSize="16"
                                       TextColor="{DynamicResource TextColor}"
                                       VerticalOptions="Center" />
                            </Grid>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenSettingsCommand}" />
                            </Frame.GestureRecognizers>
                        </Frame>

                        <!-- About Menu Item -->
                        <Frame BackgroundColor="{DynamicResource CardBackgroundColor}"
                               BorderColor="{DynamicResource BorderColor}"
                               Padding="{StaticResource SpacingMd}"
                               CornerRadius="8"
                               HasShadow="False">
                            <Grid ColumnDefinitions="Auto,*"
                                  ColumnSpacing="{StaticResource SpacingMd}">
                                <Label Grid.Column="0"
                                       Text="â„¹ï¸"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       TextColor="{DynamicResource TextColor}"
                                       Opacity="0.7" />
                                <Label Grid.Column="1"
                                       Text="{Binding AboutTitle}"
                                       FontSize="16"
                                       TextColor="{DynamicResource TextColor}"
                                       VerticalOptions="Center" />
                            </Grid>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenAboutCommand}" />
                            </Frame.GestureRecognizers>
                        </Frame>

                        <!-- Logout Menu Item -->
                        <Frame BackgroundColor="{DynamicResource CardBackgroundColor}"
                               BorderColor="{DynamicResource BorderColor}"
                               Padding="{StaticResource SpacingMd}"
                               CornerRadius="8"
                               HasShadow="False">
                            <Grid ColumnDefinitions="Auto,*"
                                  ColumnSpacing="{StaticResource SpacingMd}">
                                <Label Grid.Column="0"
                                       Text="ðŸšª"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       TextColor="{DynamicResource TextColor}"
                                       Opacity="0.7" />
                                <Label Grid.Column="1"
                                       Text="{Binding LogoutTitle}"
                                       FontSize="16"
                                       TextColor="{DynamicResource TextColor}"
                                       VerticalOptions="Center" />
                            </Grid>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding LogoutCommand}" />
                            </Frame.GestureRecognizers>
                        </Frame>

                    </VerticalStackLayout>
                </ScrollView>

            </Grid>
        </DataTemplate>
    </Shell.FlyoutContentTemplate>

    <!-- Non-flyout pages (shown without menu) -->
    <ShellContent Route="bootstrapper" ContentTemplate="{DataTemplate views:BootstrapperPage}" />
    <ShellContent Route="welcome" ContentTemplate="{DataTemplate views:WelcomePage}" />
    <ShellContent Route="avatarselection" ContentTemplate="{DataTemplate views:AvatarSelectionPage}" />
    <ShellContent Route="roomselection" ContentTemplate="{DataTemplate views:RoomSelectionPage}" />

    <!-- Flyout Menu Items -->
    <FlyoutItem Title="{Binding ChatRoomTitle}"
                Icon="ðŸ’¬"
                Route="chat"
                FlyoutDisplayOptions="AsMultipleItems">
        <ShellContent
            ContentTemplate="{DataTemplate views:ChatRoomPage}"
            Route="chat" />
    </FlyoutItem>

    <!-- Room Selection Menu Item -->
    <FlyoutItem Title="Select Room"
                Icon="ðŸšª"
                Route="roomselection"
                FlyoutDisplayOptions="AsMultipleItems">
        <ShellContent
            ContentTemplate="{DataTemplate views:RoomSelectionPage}"
            Route="roomselection" />
    </FlyoutItem>

    <!-- Logout Menu Item -->
    <MenuItem Text="{Binding LogoutTitle}"
              Command="{Binding LogoutCommand}"
              IsDestructive="True" />

    <!-- Additional Menu Items (opened modally) -->
    <MenuItem Text="{Binding SettingsTitle}"
              Command="{Binding OpenSettingsCommand}" />
    <MenuItem Text="{Binding AboutTitle}"
              Command="{Binding OpenAboutCommand}" />

</Shell>
